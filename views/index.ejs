<%- include('partials/header.ejs'); -%>

<section style="padding-left: var(--space-xl); padding-right: var(--space-xl); max-width: 1400px; margin: 0 auto;">
  <h1>ðŸŽ¬ My Movie Collection</h1>

  <% if (movies.length === 0) { %>
    <div class="text-center mt-3">
      <p class="text-muted">No movies added yet. <a href="/add">Add your first movie!</a></p>
    </div>
  <% } else { %>
    <div class="sort-controls">
      <select id="sortSelect" class="sort-select" onchange="sortMovies()">
        <option value="title" <% if(currentSort === 'title') { %>selected<% } %>>
          Sort by Title
        </option>
        <option value="director" <% if(currentSort === 'director') { %>selected<% } %>>
          Sort by Director
        </option>
        <option value="rating" <% if(currentSort === 'rating') { %>selected<% } %>>
          Sort by Rating
        </option>
      </select>
    </div>

    <ul id="movie-details">
      <% movies.forEach(movie => { %>
        <li class="fade-in">
          <img
            src="<%= movie.cover_url || '/assets/placeholder.png' %>"
            alt="<%= movie.title %> Cover"
            loading="lazy"
          />
          <div>
            <p><strong>Title:</strong> <%= movie.title %></p>
            <p><strong>Director:</strong> <%= movie.director %></p>
            <p><strong>Rating:</strong> <strong style="color: #ffc107;">â˜…</strong> <%= movie.rating %>/10</p>
            <p><strong>Description:</strong> <%= movie.description %></p>
            <% if (movie.userComment) { %>
              <p><strong>Your Comment:</strong> <%= movie.userComment %></p>
            <% } %>
          </div>
          <div class="movie-actions">
            <a href="/update/<%= movie.id %>" id="edit" class="btn btn-primary">
              <i class="fas fa-edit"></i>
              Edit
            </a>
            <a
              href="/delete/<%= movie.id %>"
              id="delete"
              class="btn btn-delete"
              onclick="return confirm('Are you sure you want to delete this movie?');"
            >
              <i class="fas fa-trash"></i>
              Delete
            </a>
          </div>
        </li>
      <% }); %>
    </ul>
  <% } %>
</section>

<script>
  function sortMovies() {
    const sortSelect = document.getElementById('sortSelect');
    const selectedSort = sortSelect.value;
    window.location.href = `/?sortBy=${selectedSort}`;
  }
</script>

<%- include('partials/footer.ejs'); -%>

